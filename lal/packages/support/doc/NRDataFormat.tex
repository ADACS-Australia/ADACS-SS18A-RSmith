%%%%$Id$%%%

\documentclass{article}
\usepackage{amsmath,amssymb,graphicx,rcs}
\numberwithin{equation}{section}
\newcommand{\Ys}{{{}^sY}}
\newcommand{\Ytwo}{{{}^{-2}Y}}
\newcommand{\tens}[1]{\overleftrightarrow{#1}}
\newcommand{\xhat}{\vec{e}_x}
\newcommand{\yhat}{\vec{e}_y}
\newcommand{\zhat}{\vec{e}_z}
\newcommand{\ihat}{\vec{e}_i}
\newcommand{\jhat}{\vec{e}_j}
\newcommand{\rhat}{\vec{e}_{r}}
\newcommand{\iotahat}{\vec{e}_{\iota}}
\newcommand{\phihat}{\vec{e}_{\phi}}
\newcommand{\eplus}{\tens{e}_+}
\newcommand{\ecross}{\tens{e}_\times}
\RCS $Date$
\title{Data formats for numerical relativity waves}
\date{\RCSDate}
\author{Author list TBD}
\begin{document}
\maketitle

\begin{abstract}
This document describes data formats to further the interaction
between numerical relativity groups and the LSC. The aim is to have a
simple format which is nevertheless sufficiently general so that all
numerical relativity groups can use it.  
\end{abstract}

\section{Multipole expansion of the wave}
\label{sec:multipoles}

The output of a numerical relativity code is the full spacetime of a
binary black hole system while what is required for data analysis
purposes is the strain $h(t)$ as measured by a detector.  The quantity
of interest is the gravitational wave $h_{ij}$ where $i$ and $j$ are
spatial indices and $h_{ij}$ is a transverse-traceless tensor.  We
always work in the TT gauge so that the $h_{ij}$ contains all the
information of the metric perturbation.  The wave falls off as $1/r$
where $r$ is the distance from the source
\begin{equation}
  \label{eq:1}
  h_{ij} = \frac{A_{ij}}{r} 
\end{equation}
where $A_{ij}$ is a transverse traceless tensor.  

There are different methods for extracting $h_{ij}$ from a numerical
evolution.  One common method is to use the complex Weyl tensor
component $\Psi_4$ which is related to the second time derivative of
$h_{ij}$. Another method is to use the Zerilli function which
approximates the spacetime in the wave-zone as a perturbation of a
Schwarzschild spacetime.  For our purposes, it is not important how
the wave is extracted, and different groups are free to use whatever
methods they find appropriate.  The starting point of our analysis are
the multipole moments of $h_{ij}$ and it is important to describe
explicitly our conventions for the multipole decomposition.  In
addition to these multipole moments, we also require the corresponding
values of $\Psi_4$ or the Zerilli function in the formats described
later. 


Introduce a coordinate system $(x,y,z,t)$ associated with the binary
system as follows.  The orbital plane of the binary at $t=0$ is taken to
be the $x$-$y$ plane with the $z$-axis in the direction of the orbital
angular momentum.  The orbital plane works when the black holes are
non-spinning but it can be ambiguous, especially when the spin of the
black holes causes the orbital plane to precess significantly.
Similarly, the $x$-axis is chosen so that the orbital phase of the
binary vanishes at $t=0$.   This still leaves open the question of what
to choose as the zero of time.  The two obvious choices are the
beginning of the simulation and the time at coalescence (although the
latter may well be slicing dependent).  It is not immediately clear
which would be preferable, especially in the case of spinning systems.

Let $\xhat$, $\yhat$ and $\zhat$ denote the
orthonormal coordinate basis vectors. Given this coordinate system, we
define spherical coordinates $(r,\iota,\phi)$ where $\iota$ is the
inclination angle from the $z$-axis and $\phi$ is the phase angle.  We
break up $h_{ij}$ into modes in this coordinate system.
In the wave zone, the wave will be propagating in the direction of
\begin{subequations}
  \begin{alignat}{3}
    \rhat &=  &\xhat&\,\sin\iota\cos\phi\, &+&\, \yhat\,\sin\iota\sin\phi
    + \zhat\,\cos\iota
\intertext{A natural set of orthogonal basis vectors from which to build the
transverse traceless basis tensors is}
    \iotahat &=
    &\xhat&\,\cos\iota\cos\phi \,&+&\, \yhat\,\cos\iota\sin\phi
    - \zhat\,\sin\iota \\
    \phihat &=
    -\,&\xhat&\,\sin\phi \,&+&\, \yhat\,\cos\phi
  \end{alignat}
\end{subequations}
Note in particular that $\phihat$ is perpendicular to $\zhat$.
In the transverse traceless gauge, $h_{ij}$ is has two independent
polarizations 
\begin{equation}
  \label{eq:2}
  \tens{h} = \sum_{i,j}h_{ij}\,\ihat\otimes\jhat
  = h_+ \eplus + h_\times \ecross\,,
\end{equation}
where $\eplus$ and $\ecross$ are the usual basis tensors for
transverse-traceless tensors in the wave frame
\begin{equation}
  \label{eq:9}
  \eplus = \iotahat\otimes\iotahat -
  \phihat\otimes\phihat\,, \qquad \textrm{and} \qquad 
  \ecross = \iotahat\otimes\phihat +
  \phihat\otimes\iotahat\,. 
\end{equation}
It is convenient to use the combination $h_+ - ih_\times$ which is
related to the Weyl tensor component $\Psi_4$ by two time derivatives:
\begin{equation}
  \label{eq:3}
  \Psi_4 = - \ddot{h}_+ i\ddot{h}_\times\,.
\end{equation}
It can be shown that $h_+-ih_\times$, can be decomposed into
modes using spin weighted spherical harmonics $\Ys_{lm}$ of weight
-2:
\begin{equation}
  \label{eq:4}
  h_+ - ih_\times = \frac{1}{r}\sum_{\ell=2}^{\infty}\sum_{m=-\ell}^\ell H_{\ell m}(t)\,
  \Ytwo_{\ell m}(\iota,\phi)\,.
\end{equation}
The expansion parameters $H_{lm}$ are complex functions of the retarded time
$t-r$ and, if we fix $r$ to be the radius of the sphere at which we
extract waves, then $H_{lm}$ are functions of $t$ only.  

The explicit expression for the spin weighted spherical harmonics is
in terms of the Wigner $d$-functions
\begin{equation}
  \label{eq:5}
   \Ys_{lm} = (-1)^s\sqrt{\frac{2\ell+1}{4\pi}} d^\ell_{m,-s}(\iota)e^{im\phi}
\end{equation}
where
\begin{eqnarray}
  \label{eq:6}
  d^\ell_{m,s}(\iota) &=& \sum_{k = k_1}^{k_2}
    \frac{(-1)^k[(\ell+m)!(\ell-m)!(\ell+s)!(\ell-s)!]^{1/2}}{(\ell +m
      -k)!(\ell-s-k)!k!(k+s-m)!} \times \\ 
    &&\times \left(\frac{\cos\iota}{2}\right)^{2\ell+m-s-2k}\left(\frac{\sin\iota}{2}\right)^{2k+s-m}  
\end{eqnarray}
with $k_1 = \textrm{max}(0, m-s)$ and $k_2=\textrm{min}(\ell+m,
\ell-s)$.  For reference,
\begin{eqnarray}
  \label{eq:7}
  \Ytwo_{2-2} &=& \sqrt{\frac{5}{64\pi}}(1-\cos\iota)^2e^{-2i\phi}\,, \\
  \Ytwo_{22} &=& \sqrt{\frac{5}{64\pi}}(1+\cos\iota)^2e^{2i\phi} \,.
\end{eqnarray}
The mode expansion coefficients $H_{lm}$ are given by
\begin{equation}
  \label{eq:10}
  H_{\ell m} = \oint \Ytwo_{lm}^\star(\iota,\phi)(rh_+-irh_\times )\,d\Omega\,.
\end{equation}
If $\Psi_4$ is used for wave extraction, then $H_{lm}$ is given by two
time integrals of the corresponding mode of $\Psi_4$.  It is important
that the integration constants be chosen to make sure, as far as
possible, that $h_{+,\times}$ do not have a secular drift, i.e. they
vanish initially and at late times.  For waveforms which evolve right
through the merger and ringdown, the vanishing at late times should be
unambiguous.  However, in numerical simulations, there is often spurious
radiation at the beginning of the evolution.  When to we require the
waveform to be zero?  Before or after this radiation has gone out?

We define $h_+^{(\ell m)}$ and $h_\times^{(\ell m)}$ as
\begin{equation}
  \label{eq:11}
  h_+^{(\ell m)}(t) -ih_\times^{(\ell m)}(t) := \frac{H_{\ell m}(t)}{r}\,.  
\end{equation}
It is these modes of $rh_+$ and $rh_\times$ that must be provided as
funtions of time.  





\section{Data formats}
\label{sec:format}


For our purposes, a single numerical waveform is defined by 9
parameters: the mass ratio $M_1/M_2$, the three components of the
individual spins $\vec{S}_1$ and $\vec{S}_2$ and the mode
numbers $(l,m)$.  These 9 parameters will be referred to as the
``metadata'' for a waveform.  ***We can add more parameters to this
metadata if necessary.***

The data for a single mode $rh_{+,\times}^{lm}$ is to be written as a
plain text file in three columns for the time $t$, $rh_+$ and
$rh_\times$.  The time must be in units of the total mass $M$ of the
binary (or, almost equivalently, the ADM mass) and the sampling must be
uniform.  If the result of a simulation or set of simulations yields a
waveform sampled non-uniformly, we ask that the NR group interpolate to
give a uniformly sampled waveform.  A sampling rate of $1\times M$ is
sufficient for our purposes, but there is no other restriction on it.
The strain multiplied by the distance will also be in units of the total
mass $M$ of the binary.  There can be any number of comment lines at the
top of the file and it is envisioned that the details of the simulation
and the mode contained in the file will be held in the comment lines.
This is an example of a data file 

\begin{verbatim}
# time       hplus        hcross
0.000000e+00 1.138725e-02 -8.319811e-04
2.000000e-01 1.138725e-02 -1.247969e-03
4.000000e-01 1.138726e-02 -1.663954e-03
6.000000e-01 1.138727e-02 -2.079936e-03
8.000000e-01 1.138728e-02 -2.495913e-03
1.000000e-00 1.138728e-02 -2.911884e-03
1.200000e+00 1.138729e-02 -3.327850e-03
1.400000e+00 1.138730e-02 -3.743807e-03
1.600000e+00 1.138731e-02 -4.159757e-03
1.800000e+00 1.138733e-02 -4.575696e-03
2.000000e+00 1.138734e-02 -4.991627e-03
2.200000e+00 1.138735e-02 -5.407545e-03
2.400000e+00 1.138737e-02 -5.823452e-03
2.600000e+00 1.138739e-02 -6.239345e-03
2.800000e+00 1.138740e-02 -6.655225e-03
3.000000e+00 1.138752e-02 -7.071059e-03
3.200000e+00 1.138754e-02 -7.486903e-03
3.400000e+00 1.138757e-02 -7.902739e-03
\end{verbatim}

The metadata information for the different datafiles will be stored in
a separate file.  This metadata file will also be plain text and
will have 10 columns: 9 for the metadata and the last one specifying
the location of the corresponding datafile.  This is an example of a
metadata file containing two waveforms:
\begin{verbatim}
## example wave
## m1/m2 S1x S1y S1z S2x S2y S2z l m filename
1.0 0.0 0.0 0.0 0.0 0.0 0.0  2 2 ./example1.dat
## another example
1.0 1.0 0.0 0.0 0.0 -1.0 0.0  2 1 ./example2.dat
\end{verbatim}
Lines starting with a $\%$ or $\#$ will be taken to be comment lines and
ignored. There can be an arbitrary number of comment lines.  **more***



\end{document}
