%%%%$Id$%%%

\documentclass{article}
\usepackage{amsmath,amssymb,graphicx,rcs}
\numberwithin{equation}{section}
\newcommand{\Ys}{{{}^sY}}
\newcommand{\Ytwo}{{{}^{-2}Y}}
\newcommand{\tens}[1]{\overleftrightarrow{#1}}
\newcommand{\xhat}{\vec{e}_x}
\newcommand{\yhat}{\vec{e}_y}
\newcommand{\zhat}{\vec{e}_z}
\newcommand{\ihat}{\vec{e}_i}
\newcommand{\jhat}{\vec{e}_j}
\newcommand{\rhat}{\vec{e}_{r}}
\newcommand{\that}{\vec{e}_{t}}
\newcommand{\iotahat}{\vec{e}_{\iota}}
\newcommand{\phihat}{\vec{e}_{\phi}}
\newcommand{\eplus}{\tens{e}_+}
\newcommand{\ecross}{\tens{e}_\times}

\newcommand{\ellhat}{\vec{\ell}}
\newcommand{\nhat}{\vec{n}}
\newcommand{\mhat}{\vec{m}}
\newcommand{\mbarhat}{\vec{\bar{m}}}

\RCS $Date$
\title{Data formats for numerical relativity waves}
\date{\RCSDate}
\author{Author list TBD}
\begin{document}
\maketitle

\begin{abstract}
  This document describes data formats to further the interaction
  between gravitational wave source modeling groups and the LIGO
  Scientific Collaboration. The aim is to have a simple format which
  is nevertheless sufficiently general and applicable to various kinds
  of sources including binaries of compact objects and systems
  undergoing gravitational collapse.
\end{abstract}

\section{Introduction}
\label{sec:intro}

Numerical relativity has made enormous progress in the last few years.
Many numerical relativity groups now have stable and accurate codes
which can accurately simulate the inspiral, merger and ringdown phases
of binary black hole coalescence.  Similarly, significant progress has
been made in the numerical simulation of stellar gravitational
collapse and there is now a much better understanding of how supernova
explosions happen.  All these processes are among the most promising
sources of gravitational radiation and therefore there is significant
interest in using these numerical relativity results within various
data analysis pipelines used within the LSC.  A dialogue between
numerical relativists and LIGO data analysts was recently initiated in
November 2006 through a meeting in Boston, and it seems appropriate to
continue this dialogue at a more concrete level, and to start
incorporating numerical relativity results within various LSC data
analysis software. 

The aim of this document is to spell out the formats for data exchange
between numerical relativists and the LIGO Scientific Collaboration.
It is clear that there are still outstanding conceptual and numerical
issues remaining in these numerical simulations, and the goal of this
document is not to resolve them.  The goal is simply to spell out the
technical details of the waveform data so that it can be incorporated
seamlessly with the data analysis software currently being developed
within the LSC.  

The relevant software development is being carried out as part of the
LIGO Algorithms Library
\footnote{\texttt{http://www.lsc-group.phys.uwm.edu/daswg/projects/lal.html}}
which contains core routines for gravitational wave data analysis
written in ANSI C89.  The latest version of this document is available
within this library.
\footnote{\texttt{lal/packages/support/doc/NRDataFormat.tex}}



\section{Multipole expansion of the wave}
\label{sec:multipoles}

The output of a numerical relativity code is the full spacetime of a
binary black hole system while what is required for data analysis
purposes is the strain $h(t)$ as measured by a detector.  The quantity
of interest is the gravitational wave $h_{ij}$ where $i$ and $j$ are
spatial indices and $h_{ij}$ is a transverse-traceless tensor.  We
always work in the TT gauge so that the $h_{ij}$ contains all the
information of the metric perturbation.  The wave falls off as $1/r$
where $r$ is the distance from the source
\begin{equation}
  \label{eq:1}
  h_{ij} = H_{ij}\frac{M}{r} \,.
\end{equation}
Here $H_{ij}$ is a transverse traceless tensor and $M$ is the total
mass of the system; this equation is, naturally, only valid far away
from the source.  

There are different methods for extracting $h_{ij}$ from a numerical
evolution.  One common method is to use the complex Weyl tensor
component $\Psi_4$ which is related to the second time derivative of
$h_{ij}$. Another method is to use the Zerilli function which
approximates the spacetime in the wave-zone as a perturbation of a
Schwarzschild spacetime.  For our purposes, it is not important how
the wave is extracted, and different numerical relativity groups are
free to use whatever methods they find appropriate.  The starting
point of our analysis are the multipole moments of $h_{ij}$ and it is
important to describe explicitly our conventions for the multipole
decomposition.  In addition to these multipole moments, we also
require the corresponding values of $\Psi_4$ or the Zerilli function
in the formats described later.

Let $(x,y,z,t)$ be a Cartesian coordinate system in the wave zone,
sufficiently far away from the source. Let $\xhat$, $\yhat$ and
$\zhat$ denote the spatial orthonormal coordinate basis vectors.
Given this coordinate system, we define standard spherical coordinates
$(r,\iota,\phi)$ where $\iota$ is the inclination angle from the
$z$-axis and $\phi$ is the phase angle.  At this point, we have not
specified anything about the source.  In fact, the source could be a
binary system, a star undergoing gravitational collapse or anything
else that could be of interest for gravitational wave source modeling.
In a later section we will specialize to binary black hole systems and
suggest possibilities for some of the various choices that have to be
made.  However, as far as possible, these choices are eventually to be
made by the individual source modeling group.

We break up $h_{ij}$ into modes in this coordinate system.  In the
wave zone, the wave will be propagating in the direction of
\begin{subequations}
  \begin{alignat}{3}
    \rhat &=  &\xhat&\,\sin\iota\cos\phi\, &+&\, \yhat\,\sin\iota\sin\phi
    + \zhat\,\cos\iota
\intertext{A natural set of orthogonal basis vectors from which to build the
transverse traceless basis tensors is}
    \iotahat &=
    &\xhat&\,\cos\iota\cos\phi \,&+&\, \yhat\,\cos\iota\sin\phi
    - \zhat\,\sin\iota \\
    \phihat &=
    -\,&\xhat&\,\sin\phi \,&+&\, \yhat\,\cos\phi
  \end{alignat}
\end{subequations}
Note in particular that $\phihat$ is perpendicular to $\zhat$.
In the transverse traceless gauge, $h_{ij}$ is has two independent
polarizations 
\begin{equation}
  \label{eq:2}
  \tens{h} = \sum_{i,j}h_{ij}\,\ihat\otimes\jhat
  = h_+ \eplus + h_\times \ecross\,,
\end{equation}
where $\eplus$ and $\ecross$ are the usual basis tensors for
transverse-traceless tensors in the wave frame
\begin{equation}
  \label{eq:9}
  \eplus = \iotahat\otimes\iotahat -
  \phihat\otimes\phihat\,, \qquad \textrm{and} \qquad 
  \ecross = \iotahat\otimes\phihat +
  \phihat\otimes\iotahat\,. 
\end{equation}
It is convenient to use the combination $h_+ - ih_\times$ which is
related to $\Psi_4$ by two time derivatives\footnote{We define
  $\Psi_4$ as $\Psi_4 := C_{abcd}\ell^a \bar{m}^b \bar{m}^c n^d$ where
  $C_{abcd}$ is the Weyl tensor and $a,b\ldots$ denote spacetime
  indices.  If we denote the unit timelike normal to the spatial slice
  as $\that$, then the null tetrad adapted to the constant $r$ spheres
  is $(\ell^a,n^a,m^a,\bar{m}^a)$ is $\ellhat = (\that + \rhat)/\sqrt{2}$,
  $\nhat = (\that - \rhat)/\sqrt{2}$, $\mhat = (\iotahat +
  i\phihat)/\sqrt{2}$ and $\mbarhat$ is the complex conjugate of
  $\mhat$.}
\begin{equation}
  \label{eq:3}
  \Psi_4 = \ddot{h}_+ - i\ddot{h}_\times\,.
\end{equation}
It can be shown that $h_+-ih_\times$, can be decomposed into
modes using spin weighted spherical harmonics $\Ys_{lm}$ of weight
-2:
\begin{equation}
  \label{eq:4}
  h_+ - ih_\times = \frac{1}{r}\sum_{\ell=2}^{\infty}\sum_{m=-\ell}^\ell H_{\ell m}(t)\,
  \Ytwo_{\ell m}(\iota,\phi)\,.
\end{equation}
The expansion parameters $H_{lm}$ are complex functions of the retarded time
$t-r$ and, if we fix $r$ to be the radius of the sphere at which we
extract waves, then $H_{lm}$ are functions of $t$ only.  

The explicit expression for the spin weighted spherical harmonics is
in terms of the Wigner $d$-functions
\begin{equation}
  \label{eq:5}
   \Ys_{lm} = (-1)^s\sqrt{\frac{2\ell+1}{4\pi}} d^\ell_{m,-s}(\iota)e^{im\phi}
\end{equation}
where
\begin{eqnarray}
  \label{eq:6}
  d^\ell_{m,s}(\iota) &=& \sum_{k = k_1}^{k_2}
    \frac{(-1)^k[(\ell+m)!(\ell-m)!(\ell+s)!(\ell-s)!]^{1/2}}{(\ell +m
      -k)!(\ell-s-k)!k!(k+s-m)!} \times \\ 
    &&\times \left(\frac{\cos\iota}{2}\right)^{2\ell+m-s-2k}\left(\frac{\sin\iota}{2}\right)^{2k+s-m}  
\end{eqnarray}
with $k_1 = \textrm{max}(0, m-s)$ and $k_2=\textrm{min}(\ell+m,
\ell-s)$.  For reference,
\begin{eqnarray}
  \label{eq:7}
  \Ytwo_{2-2} &=& \sqrt{\frac{5}{64\pi}}(1-\cos\iota)^2e^{-2i\phi}\,, \\
  \Ytwo_{22} &=& \sqrt{\frac{5}{64\pi}}(1+\cos\iota)^2e^{2i\phi} \,.
\end{eqnarray}
The mode expansion coefficients $H_{lm}$ are given by
\begin{equation}
  \label{eq:10}
  H_{\ell m} = \oint \Ytwo_{lm}^\star(\iota,\phi)(rh_+-irh_\times )\,d\Omega\,.
\end{equation}
If $\Psi_4$ is used for wave extraction, then $H_{lm}$ is given by two
time integrals of the corresponding mode of $\Psi_4$.  It is important
that the integration constants be chosen to make sure, as far as
possible, that $h_{+,\times}$ do not have a secular drift. 
We define $h_+^{(\ell m)}$ and $h_\times^{(\ell m)}$ as
\begin{equation}
  \label{eq:11}
  h_+^{(\ell m)}(t) -ih_\times^{(\ell m)}(t) := \frac{H_{\ell m}(t)}{r}\,.  
\end{equation}
It is these modes $H_{\ell m}$ of $rh_+$ and $rh_\times$ that must be
provided as functions of time.  
% The waveforms are easily reconstructed
% from the modes:
% \begin{equation}
%   \label{eq:8}
%   rh_+(r,\theta,\phi) - i rh_\times(x,\theta,\phi)
%   = \sum_{lm} \Ytwo_{lm}(\theta,\phi)\left[ H_+^{(\ell m)}(x) - i
%   H_\times^{(\ell m)}\right]
% \end{equation}




\section{Data formats}
\label{sec:format}


For our purposes, a single numerical waveform is defined by \emph{at
  least} 9 parameters: the mass ratio $q = M_1/M_2$, the three
components of the individual spins $\vec{S}_1$ and $\vec{S}_2$ and the
mode numbers $(l,m)$.  These 9 parameters will be referred to as the
``metadata'' for a waveform.  It is possible to add more parameters to
this metadata if necessary. We use the convention that $M_1$ denotes
the larger of the two masses so that $q\geq 1$.  The choice of
precisely how the individual masses $M_1$ and $M_2$ are calculated is
to be decided by the individual numerical relativity groups.  Thus,
for non-spinning black holes, $M_1$ and $M_2$ could be the irreducible
masses of the two horizons, and for spinning black holes it could be
given by the Christodoulou formula with an appropriately defined spin.

The data for a single mode $rh_{+,\times}^{lm}$ is to be written as a
plain text file in three columns for the time $t$, $rh_+$ and
$rh_\times$ respectively.  For a given value of $\ell$, we require
that waveforms be provided for all values of
$m=-\ell,\ldots,\ell-1,\ell$.  This must be done irrespective of any
symmetries that may be present in the simulation.  The time must be in
units of the total mass $M$ of the binary.  There can be subtleties in
the choice of $M$.  It could be the ADM mass of the spacetime, or it
could be the sum of the individual masses.  Again, the choice is left
up to the numerical relativity group which produced the waveform.  It
should be whatever best represents the time coordinate of the
particular simulation.

The sampling in time must be uniform in units of $M$.  If the result
of a simulation or set of simulations yields a waveform sampled
non-uniformly, we ask that the NR group interpolate to give a
uniformly sampled waveform.  A sampling rate of $1\times M$ is usually
sufficient for our purposes, but this is not a requirement.  The
strain multiplied by the distance will also be in units of the total
mass $M$ of the binary.  There can be any number of comment lines at
the top of the file and it is envisioned that the details of the
simulation and the mode contained in the file will be held in the
comment lines.  This is an example of a data file:

\begin{verbatim}
# numerical waveform from ....
# equal mass, non spinning, 5 orbits
# time       hplus        hcross
0.000000e+00 1.138725e-02 -8.319811e-04
2.000000e-01 1.138725e-02 -1.247969e-03
4.000000e-01 1.138726e-02 -1.663954e-03
6.000000e-01 1.138727e-02 -2.079936e-03
8.000000e-01 1.138728e-02 -2.495913e-03
1.000000e-00 1.138728e-02 -2.911884e-03
1.200000e+00 1.138729e-02 -3.327850e-03
1.400000e+00 1.138730e-02 -3.743807e-03
1.600000e+00 1.138731e-02 -4.159757e-03
1.800000e+00 1.138733e-02 -4.575696e-03
2.000000e+00 1.138734e-02 -4.991627e-03
2.200000e+00 1.138735e-02 -5.407545e-03
2.400000e+00 1.138737e-02 -5.823452e-03
2.600000e+00 1.138739e-02 -6.239345e-03
2.800000e+00 1.138740e-02 -6.655225e-03
3.000000e+00 1.138752e-02 -7.071059e-03
3.200000e+00 1.138754e-02 -7.486903e-03
3.400000e+00 1.138757e-02 -7.902739e-03
......
\end{verbatim}

The metadata information for the different datafiles will be stored in
a separate file.  This metadata file will also be plain text and
will have 10 columns: 9 for the metadata and one specifying
the location of the corresponding datafile.  This is an example of a
metadata file containing two waveforms:
\begin{verbatim}
## example wave
## m1/m2 S1x S1y S1z S2x S2y S2z l m filename
1.0 0.0 0.0 0.0 0.0 0.0 0.0  2 2 example1.dat
## another example
1.5 1.0 0.0 0.0 0.0 -1.0 0.0  2 1 example2.dat
\end{verbatim}
Lines starting with a $\%$ or $\#$ will be taken to be comment lines and
ignored.  There can be an arbitrary number of comment lines.  The
filenames must give the relative paths to the data files starting from
the location of the metadata file.  Thus, if the datafiles are stored
in a sub-directory called \texttt{data}, then the metadata file would read:
\begin{verbatim}
## example wave
## filename       l m m1/m2 S1x S1y S1z S2x S2y S2z 
data/example1.dat 2 2 1.0 0.0 0.0 0.0 0.0 0.0 0.0
## another example
data/example2.dat 2 1 1.5 1.0 0.0 0.0 0.0 -1.0 0.0
\end{verbatim}
The purpose of the metadata file is to describe the parameters for a
single or multiple numerical simulation and it should be emphasized
that we will add more parameters as necessary such as, for example, the
eccentricity of the orbit.  

If the waveforms have been calculated using $\Psi_4$, then for
cross-checking purposed, datafiles for the real and imaginary parts of
$\Psi_4$ must also be provided in the same format as for the
waveforms, i.e. three columns which are respectively time, real part
of $\Psi_4$ and imaginary part of $\Psi_4$.  Again there can be an
arbitrary number of comment lines, but in this case there does not
need to be a metadata file.


\section{Open Issues for binary black hole systems}

We now specialize to the case of binary black hole simulations and we
list the open issues which can be topics for further discusion as
bullet points.  

We associate the coordinate system $(x,y,z,t)$ with the binary system
as follows.  The orbital plane of the binary at $t=0$ is taken to be
the $x$-$y$ plane with the $z$-axis in the direction of the orbital
angular momentum.
\begin{itemize}
\item Is this the best choice of the $z$-axis?  Would it be better to
  choose, say, the spin of the final black hole? The decisions will be
  determined by requirements of simplicity and having as few modes to
  work with as possible.  
\end{itemize}
Because of precession effects, the orbital plane is unambiguous when
the black holes are non-spinning but it can be ambiguous in many
situations, especially when the spin of the black holes causes the
orbital plane to precess significantly.  In such cases, it is left to
the numerical relativity group to decide what the best choice of the
``orbital plane'' should be.

We now need to make a choice for the phase. 
\begin{itemize}
\item The two obvious choices are the beginning of the simulation and
  the time at coalescence defined perhaps as the peak of $h_+^2 +
  h_\times^2$.  It is not immediately clear which would be preferable.
\end{itemize}
What is the right choice for the individual masses and the total mass
which sets the scale for the amplitude and the time?
\begin{itemize}
\item Should we use the individual horizon masses (including the
  effect of angular momentum), or should it be the total ADM mass or
  rather, the ADM mass calculated at the sphere where the waves are
  extracted.  
\end{itemize}

\section{Authorship Rights}


A webpage will be set up where waveform data can be uploaded in the
format specified above.  Access to this webpage will be open to any
numerical relativity group which wishes to be involved in this
project.  However, uploading the waveforms does by any means guarantee
that they will be used by the LSC to analyze real data from the LIGO
and GEO detectors.  It also does not imply any authorship rights on
possible publications that may arise from this data.

It is expected (though not required) that the waveforms supplied to
the LSC through this forum have previously been published in a peer
reviewed journal.  Any publication arising from these waveform data
will cite the appropriate publication and funding agency as specified
by the numerical relativity group.







\end{document}
