#!/bin/sh

## This is a script for the software librarian to use to generate neccessary
## files from the minimal set in the cvs archive.
##
## This script is not to be included in the distribution.

# Help message
helpmsg="Usage $0 [options]
Options: [defaults in brackets after description]"
helpmsg="$helpmsg
  --help                print this message"
helpmsg="$helpmsg
  --include-deps        pass option --include-deps to automake [no]"

INCLUDEDEPS=""

# Process args
while test $# -gt 0 ; do
  option=$1
  case "$option" in
    -*=*) optarg=`echo "$option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
    *) optarg= ;;
  esac
  case $option in
    -h | -help | --help ) echo "$helpmsg"; exit 0;;
    -include-deps | --include-deps ) INCLUDEDEPS=" --include-deps";;
    *) echo "unrecognized option $option"; exit 1;;
  esac
  shift
done


cd packages/support/src
m4 PrintVector.m4 > PrintVector.c
m4 PrintTimeSeries.m4 > PrintTimeSeries.c
m4 PrintFrequencySeries.m4 > PrintFrequencySeries.c
m4 ReadFrequencySeries.m4 > ReadFrequencySeries.c
m4 ReadTimeSeries.m4 > ReadTimeSeries.c
cd ../../..

cd packages/factories/src
m4 VectorFactories.m4 > VectorFactories.c
m4 VectorSequenceFactories.m4 > VectorSequenceFactories.c
m4 ArrayFactories.m4 > ArrayFactories.c
cd ../../..

cd packages/factories/test
m4 VectorFactoriesTest.m4 > VectorFactoriesTest.c
m4 VectorSequenceFactoriesTest.m4 > VectorSequenceFactoriesTest.c
m4 ArrayFactoriesTest.m4 > ArrayFactoriesTest.c
cd ../../..

aclocal
autoheader
automake $INCLUDEDEPS
autoconf
