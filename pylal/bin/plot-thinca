#!/usr/bin/python

import sys
import os
import getopt
import re
import exceptions
import glob
from types import *

from pylab import *
from lgen import readMeta

# grab command line options
shortop = "b:vf:g:ht:x:X:"
longop = [
  "bins=",
  "version",
  "figure",
  "glob=",
  "help",
  "title=",
  "xlow=",
  "xhigh="]

try:
  opts, args = getopt.getopt(sys.argv[1:], shortop, longop)
except getopt.GetoptError:
  print >>sys.stderr, "Error parsing command line"
  print >>sys.stderr, "Enter 'plotburst --help' for usage"
  sys.exit(1)

# defaul values
myGlob = None
myFigure = None
myTitle = "SNR v CHISQ"
nbins = 10
xlow = 6 
xhigh = 15

for o, a in opts:
  if o in ("-h", "--help"):
    sys.exit(0)
  elif o in ("-v", "--version"):
    sys.exit(0)
  elif o in ("-b", "--bins"):
    nbins = int(a)
  elif o in ("-g", "--glob"):
    myGlob = a
  elif o in ("-f", "--figure"):
    myFigure = a
  elif o in ("-t", "--title"):
    myTitle = a
  elif o in ("-x", "--xlow"):
    xlow = a
  elif o in ("-X", "--xhigh"):
    xhigh = a

if not myGlob:
  print >>sys.stderr, "Bad combination or missing options"
  print >>sys.stderr, "Enter 'plotburst --help' for usage"
  sys.exit(1)

# glob the list of files to read in
myfiles = glob.glob(myGlob);

inspTriggers = readMeta.metaDataTable(myfiles,"sngl_inspiral")

coincTriggers = readMeta.coincInspiralTable(inspTriggers)

hsnr = coincTriggers.mkarray("snr", "H1")
hsnr = hsnr + coincTriggers.mkarray("snr", "H2")
lsnr = coincTriggers.mkarray("snr", "L1")

plot(asarray(lsnr), asarray(hsnr), 'ro')
axis([xlow, xhigh, xlow, xhigh])
xlabel(r'SNR_L', size='x-large')
ylabel(r'SNR_H', size='x-large')
title(r' ' + myTitle)
grid(True)
if myFigure:
  savefig(myFigure + "-snrvsnr.png")

show()
