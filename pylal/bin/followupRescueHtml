#!/usr/bin/env python
#
"""
followup rescue scrip to combine new format followup html with
information from the old original followup tables.

$Id$

"""

__author__ = 'Cristina Valeria Torres <cristina.torres@ligo.org>'
__date__ = '$Date: 2008/08/15 14:00'
__version__ = '$Revision$'

from pylal.scrapeHtmlUtils import scrapePage
from optparse import OptionParser
import os
import string
import sys
import time


############################################################
##
## Main Part of Code to swap information from two html tables.
##
############################################################

Usage = """\
This file requires three arguments, it expects the OLD html file
containing the table with the information we want to scrap out.  It
also expects the NEW table html file where we will put this
information.  It also expects a COMBO html file where the update
informatin will be written to.
"""

parser = OptionParser(usage=Usage)

parser.add_option("-o","--output-file",dest="outputfile",
                  default="output.html",
                  help="Specify the name you want to give to the html file that will be the result of merging the information from the old html table into the new table."
                  )
parser.add_option("-a","--original-file",dest="originalfile",
                  default="original.html",
                  help="Specify the name of the original html file so that we can extract the old table and query it's information against the new table and copy the relevant parts over."
                  )
parser.add_option("-b","--new-file",dest="newfile",
                  default="new.html",
                  help="Specify the name of the newer html file that we want to insert the table information into.  We want to take the old table information and if applies to the new table insert this information."
                  )
(options,args)=parser.parse_args()

outputfile=os.path.normpath(options.outputfile)
originalfile=os.path.normpath(options.originalfile)
newfile=os.path.normpath(options.newfile)

# Read original file into memory
original=scrapePage()
original.readfile(originalfile)
# Read new file into memory
new=scrapePage()
new.readfile(newfile)

#Extract list of rows from new html file to begin copy process.
newRowList=new.getRowList()

#Interate through the rows of this list looking for entries in the original
#html table to copy over to create the new table.
for newRow in newRowList:
    print newRow
    new.insertTextGivenText(newRow[1],
                            3,
                            original.getColumnByText(newRow[1],3))
    new.insertTextGivenText(newRow[1],
                            5,
                            original.getColumnByText(newRow[1],5))

# Manual workaroud for the very first row of the table row [0]
manual=True
if manual:
    new.insertTextAtCoord(2,3,original.getColumnByCoord(2,3))
    new.insertTextAtCoord(2,5,original.getColumnByCoord(2,5))


#Write this new object to disk
new.writeHTML(outputfile)
#
#
