\section{Program \texttt{lalapps\_thinca}}
\label{program:lalapps-thinca}
\idx[Program]{lalapps\_thinca}

\begin{entry}
\item[Name]
\verb$lalapps_thinca$ --- program does the inspiral coincidence analysis.

\item[Synopsis]
\prog{lalapps\_thinca} \newline \hspace*{0.5in}
[\option{--help}] \newline \hspace*{0.5in} 
[\option{--verbose}] \newline \hspace*{0.5in} 
[\option{--version}] \newline \hspace*{0.5in}
[\option{--user-tag}~\parm{usertag}] \newline \hspace*{0.5in} 
[\option{--ifo-tag}~\parm{ifotag}] \newline \hspace*{0.5in} 
[\option{--comment}~\parm{string}] \newline \hspace*{0.5in} 
\option{--gps-start-time}~\parm{start\_time} \newline \hspace*{0.5in}           
\option{--gps-end-time}~\parm{end\_time} \newline \hspace*{0.5in} 
[\option{--check-times}] \newline \hspace*{0.5in}
[\option{--multi-ifo-coinc}] \newline \hspace*{0.5in}
[\option{--maximization-interval}~\parm{max\_dt}] \newline \hspace*{0.5in}
\option{--parameter-test}
\parm{(m1\_and\_m2 $\mid$ psi0\_and\_psi3 $\mid$ mchirp\_and\_eta)}
\newline \hspace*{0.5in}
\option{--data-type}~\parm{(playground\_only $\mid$ exclude\_play $\mid$ 
all\_data)} \newline \hspace*{0.5in}
[\option{--g1-triggers}]  \newline \hspace*{0.5in}
[\option{--h1-triggers}]  \newline \hspace*{0.5in}
[\option{--h2-triggers}]  \newline \hspace*{0.5in}
[\option{--l1-triggers}]  \newline \hspace*{0.5in}
[\option{--t1-triggers}]  \newline \hspace*{0.5in}
[\option{--v1-triggers}]  \newline \hspace*{0.5in}
[\option{--g1-slide}~\parm{g1\_slide}]  \newline \hspace*{0.5in}
[\option{--h1-slide}~\parm{h1\_slide}]  \newline \hspace*{0.5in}
[\option{--h2-slide}~\parm{h2\_slide}]  \newline \hspace*{0.5in}
[\option{--l1-slide}~\parm{l1\_slide}]  \newline \hspace*{0.5in}
[\option{--t1-slide}~\parm{t1\_slide}]  \newline \hspace*{0.5in}
[\option{--v1-slide}~\parm{v1\_slide}]  \newline \hspace*{0.5in}
[\option{--num-slides}~\parm{num\_slides}]  \newline \hspace*{0.5in}
[\option{--g1-time-accuracy}~\parm{g1\_dt}]  \newline \hspace*{0.5in}
[\option{--h1-time-accuracy}~\parm{h1\_dt}]  \newline \hspace*{0.5in}
[\option{--h2-time-accuracy}~\parm{h2\_dt}]  \newline \hspace*{0.5in}
[\option{--l1-time-accuracy}~\parm{l1\_dt}]  \newline \hspace*{0.5in}
[\option{--t1-time-accuracy}~\parm{t1\_dt}]  \newline \hspace*{0.5in}
[\option{--v1-time-accuracy}~\parm{v1\_dt}]  \newline \hspace*{0.5in}
[\option{--g1-mass-accuracy}~\parm{g1\_dm}]  \newline \hspace*{0.5in}
[\option{--h1-mass-accuracy}~\parm{h1\_dm}]  \newline \hspace*{0.5in}
[\option{--h2-mass-accuracy}~\parm{h2\_dm}]  \newline \hspace*{0.5in}
[\option{--l1-mass-accuracy}~\parm{l1\_dm}]  \newline \hspace*{0.5in}
[\option{--t1-mass-accuracy}~\parm{t1\_dm}]  \newline \hspace*{0.5in}
[\option{--v1-mass-accuracy}~\parm{v1\_dm}]  \newline \hspace*{0.5in}
[\option{--g1-mchirp-accuracy}~\parm{g1\_dmchirp}]  \newline \hspace*{0.5in}
[\option{--h1-mchirp-accuracy}~\parm{h1\_dmchirp}]  \newline \hspace*{0.5in}
[\option{--h2-mchirp-accuracy}~\parm{h2\_dmchirp}]  \newline \hspace*{0.5in}
[\option{--l1-mchirp-accuracy}~\parm{l1\_dmchirp}]  \newline \hspace*{0.5in}
[\option{--t1-mchirp-accuracy}~\parm{t1\_dmchirp}]  \newline \hspace*{0.5in}
[\option{--v1-mchirp-accuracy}~\parm{v1\_dmchirp}]  \newline \hspace*{0.5in}
[\option{--g1-eta-accuracy}~\parm{g1\_deta}]  \newline \hspace*{0.5in}
[\option{--h1-eta-accuracy}~\parm{h1\_deta}]  \newline \hspace*{0.5in}
[\option{--h2-eta-accuracy}~\parm{h2\_deta}]  \newline \hspace*{0.5in}
[\option{--l1-eta-accuracy}~\parm{l1\_deta}]  \newline \hspace*{0.5in}
[\option{--t1-eta-accuracy}~\parm{t1\_deta}]  \newline \hspace*{0.5in}
[\option{--v1-eta-accuracy}~\parm{v1\_deta}]  \newline \hspace*{0.5in}
[\option{--g1-psi0-accuracy}~\parm{g1\_dpsi0}]  \newline \hspace*{0.5in}
[\option{--h1-psi0-accuracy}~\parm{h1\_dpsi0}]  \newline \hspace*{0.5in}
[\option{--h2-psi0-accuracy}~\parm{h2\_dpsi0}]  \newline \hspace*{0.5in}
[\option{--l1-psi0-accuracy}~\parm{l1\_dpsi0}]  \newline \hspace*{0.5in}
[\option{--t1-psi0-accuracy}~\parm{t1\_dpsi0}]  \newline \hspace*{0.5in}
[\option{--v1-psi0-accuracy}~\parm{v1\_dpsi0}]  \newline \hspace*{0.5in}
[\option{--g1-psi3-accuracy}~\parm{g1\_dpsi3}]  \newline \hspace*{0.5in}
[\option{--h1-psi3-accuracy}~\parm{h1\_dpsi3}]  \newline \hspace*{0.5in}
[\option{--h2-psi3-accuracy}~\parm{h2\_dpsi3}]  \newline \hspace*{0.5in}
[\option{--l1-psi3-accuracy}~\parm{l1\_dpsi3}]  \newline \hspace*{0.5in}
[\option{--t1-psi3-accuracy}~\parm{t1\_dpsi3}]  \newline \hspace*{0.5in}
[\option{--v1-psi3-accuracy}~\parm{v1\_dpsi3}]  \newline \hspace*{0.5in} 
[\option{--h1-h2-distance-cut}]  \newline \hspace*{0.5in}
[\option{--h1-kappa} ~\parm{h1\_kappa}]  \newline \hspace*{0.5in} 
[\option{--h2-kappa}~\parm{h2\_kappa}]  \newline \hspace*{0.5in}  
[\option{--h1-epsilon}~\parm{h1\_epsilon}] \newline \hspace*{0.5in}
[\option{--h2-epsilon}~\parm{h2\_epsilon}] \newline \hspace*{0.5in}
[\option{--dmchirp-high}~\parm{dmchirp}]  \newline \hspace*{0.5in}
[\option{--high-mass}~\parm{mass}] \newline \hspace*{0.5in}  
[\option{--do-alphaF-cut}]  \newline \hspace*{0.5in}
[\option{--alphaF-hi}~\parm{alphaFhi}] \newline \hspace*{0.5in}
[\option{--alphaF-lo}~\parm{alphaFlo}]  \newline \hspace*{0.5in}
\newline \hspace*{0.5in}
\option{LIGOLW XML input files} 

\item[Description --- General] 

\verb$lalapps_thinca$ performs a coincidence test between triggers from
different interferometers.  It reads in triggers from up to four instruments
and returns coincident triggers.  By default, the code will return all double
coincident triggers.  If the \texttt{multi-ifo-coinc} option is specified then
the code will also search for triple and quadruple coincidences.

The user specifies which instruments there will be triggers input from with
the \texttt{g1-triggers}, \texttt{h1-triggers} etc. options (if less than two
of these are specified, the program exits as there cannot be coincidence).
The triggers are then read in from the list of LIGO Lightweight XML files
given after the last command line argument.  The code performs some
pre-processing of the triggers before searching for coincidences.  If the
\texttt{do-alphaF-cut} option is given, then only triggers with an alphaF
value between \textsc{alphaFlo} and \textsc{alphaFhi} are kept.  If the
\texttt{maximization-interval} is specified, then only the loudest trigger
(per IFO) in each \textsc{max\_dt} ms is retained.  The code only keeps
triggers which occur between the \textsc{start\_time} and the
\textsc{end\_time}.  If the \texttt{check-times} option is specified, then the
input search summary tables are checked to ensure that we have searched all
data between the \textsc{start\_time} and \textsc{end\_time} in all relevant
ifos.  Following this, we discard the non-playground triggers if
\textsc{playground\_only} was specified and any playground triggers if
\textsc{exclude\_play} was specified.  At this stage, we check that there are
triggers from at least two instruments, if not, the code exits without testing
for coincidences. 

The code now tests for any pairs of coincident triggers from different
instruments.  This is done in the function
\texttt{LALCreateTwoIFOCoincList()}.  Triggers are considered coincident if
their end times and mass parameters pass coincidence.  We test either on the
two component masses if \texttt{m1\_and\_m2} is specified, on the chirp mass
and mass ratio if \texttt{mchirp\_and\_eta} is specified or on the BCV $\psi$
parameters if \texttt{psi0\_and\_psi3} is specified.  To pass time
coincidence, the end times must differ by less than (\textsc{ifoa\_dt} $+$
\textsc{ifob\_dt} $+$ light travel time).  Similarly, we require that the mass
parameters agree within (\textsc{ifoa\_dm} $+$ \textsc{ifob\_dm}).  At the end
of the process, we have a list of pairs of triggers from different instruments
which pass the time and mass coincidence tests.  For coincident triggers from
the two Hanford detectors, it is also possible to perform a distance cut by
specifying \texttt{h1-h2-distance-cut}.  In this case, values of
\textsc{h1\_kappa}, \textsc{h2\_kappa}, \textsc{h1\_epsilon} and
\textsc{h2\_epsilon} must also be specified.  The function
\texttt{XLALInspiralDistanceCut()} is used to perform the distance cut.  It
discards any triggers for which 
%
\begin{equation}
\frac{|distB - distA|}{distA} > \frac{epsilonB}{snrB} + kappaB   
\end{equation}
%
where ifo A is the ifo with the greater range at the time (as given by the
\texttt{sigmasq} values of the triggers).

The list of double coincident triggers is then searched for higher ifo
coincidences.  This is done in the function \texttt{LALCreateNIFOCoincList()}.
If, for example, a double coincidence is a subset of a triple coincidence,
then that double is removed.  All such repetitions are removed by
\texttt{LALRemoveRepeatedCoincs()}.

The coincident triggers are written into a single LIGO Lightweight XML file.
In order that the coincident triggers can be easily located, the
\textsc{event\_id} field is populated.  This is a \texttt{UINT8} which is
populated with $10^{9} \times$ \textsc{start\_time} $+$ an integer identifier.
The integer identifier is unique within the file, so the overall \textsc{id}
will be unique.  

The output file is named
\begin{center}
\texttt{IFOS-THINCA\_IFOTAG\_USERTAG-GPSSTARTTIME-DURATION.xml}\\
\end{center}
where \textsc{IFOS} is a list of the active ifos in alphabetical order.  The
file contains \texttt{process}, \texttt{process\_params},
\texttt{search\_summvars} and \texttt{search\_summary} tables that describe
the search.  Additionally there is a \texttt{summ\_value} table which contains
the summ values which were contained in the input files (in aniticipation of
performing a distance cut) as well as the \texttt{sngl\_inspiral} table
containing the coincident events.

If a non-zero argument is given to \texttt{num-slides}, then $2 \, \times$
\textsc{num\_slides} time slides are performed, half with a positive
slide and half with negative.  The amount by which the triggers of each
instrument are slid is given by the arguments to \texttt{g1-slide} etc.  The
slide time specified for each of the instruments must be non-negative and
unique.  The time slides are performed ``on a ring'', so that any trigger
which is slid past the \textsc{end\_time} is wrapped to the beginning of the
analyzed segment.  The triggers are then searched for coincidences in an
identical manner to the zero-lag case.  Again, a unique \textsc{event\_id} is
associated with each event.  This is a \texttt{UINT8} which is populated with
$\times 10^{9} \times$ \textsc{start\_time} $+ 10^{5} \times 10^{5}$ a time
slide identifier $+$ an integer identifier.  Again, the \textsc{event\_id}s
serve to uniquely specify the coincidences, and also encode which time slide
the coincidence was found in.  

When performing time slides, the output file is named 
\begin{center}
\texttt{IFOS-THINCA\_SLIDE\_IFOTAG\_USERTAG-GPSSTARTTIME-DURATION.xml}\\
\end{center}


\item[Options]\leavevmode
\begin{entry}

\item[\texttt{--data-type} (playground\_only $\mid$ exclude\_play$\mid$
all\_data)]
Required.  Specify whether the code should use only the playground, exclude
the playground or use all the data. 

\item[\texttt{--gps-start-time} \textsc{start\_time}] Required.  Look
for coincident triggers with end times after \textsc{start\_time}.

\item[\texttt{--gps-end-time} \textsc{end\_time}] Required.  Look for
coincident triggers with end times before \textsc{end\_time}.


\item[\texttt{--g1-triggers}] Optional.  Specify that triggers from G1 will be
provided.

\item[\texttt{--h1-triggers}] Optional.  Specify that triggers from H1 will be
provided.
\item[\texttt{--h2-triggers}] Optional.  Specify that triggers from H2 will be
provided.

\item[\texttt{--l1-triggers}] Optional.  Specify that triggers from L1 will be
provided.
\item[\texttt{--t1-triggers}] Optional.  Specify that triggers from T1 will be
provided.
\item[\texttt{--v1-triggers}] Optional.  Specify that triggers from V1 will be
provided.  Note: while having triggers from each of the instruments is
optional, the code requires triggers from at least two instruments, otherwise
it is impossible to do coincidence.

\item[\texttt{--check-times}] Optional.  If this flag is set, the code checks
the input search summary tables to verify that the data for each of the
requested interferometers was analyzed once and only once between the
\textsc{start\_time} and \textsc{end\_time}.  By default, the code will not
perform this check.

\item[\texttt{--maximization interval} \textsc{max\_dt}] Optional.  Keep only
one trigger per ifo in each \textsc{max\_dt} ms window.  This is the trigger
with the highest snr.  If this maximization has not been performed in the
inspiral code, it is useful to do so at the start of thinca, otherwise the
code may become swamped by the number of coincidences.

\item[\texttt{--multi-ifo-coinc}] Optional.  If this flag is set, the code
searches for triple and quadruple coincidences.  If a triple coincidence is 
found, then the double coincidences which form a subset of this triple are
removed from the list.

\item[\texttt{--parameter-test}
(m1\_and\_m2 $\mid$ psi0\_and\_psi3 $\mid$ mchirp\_and\_eta)]
Required. Choose which parameters to use when testing for coincidenc.
Depending on which test is chosen, the allowed windows on the appropriate
parameters should be set as described below.

\item[\texttt{--ifo-time-accuracy} \textsc{ifo\_dt}] Required for any ifo for
which we have triggers. Set the accuracy with which the given \texttt{ifo} can
recover the end time of a signal.  The timing accuracy is specified in
milliseconds. Here, \texttt{ifo} is one of g1, h1, h2, l1, t1, v1.

\item[\texttt{--ifo-mass-accuracy} \textsc{ifo\_dm}] Optional. Set the
accuracy with which the given \texttt{ifo} can recover the component masses of
a signal.  The mass accuracy is set in solar masses.

\item[\texttt{--ifo-mchirp-accuracy} \textsc{ifo\_dmchirp}] Optional. Set the
accuracy with which the given \texttt{ifo} can recover the chirp mass of a
signal.  The chirp mass accuracy is set in solar masses.

\item[\texttt{--ifo-eta-accuracy} \textsc{ifo\_deta}] Optional. Set the
accuracy with which the given \texttt{ifo} can recover the mass ratio $\eta$
of a signal.

\item[\texttt{--ifo-psi0-accuracy} \textsc{ifo\_dpsi0}] Optional. Set the
accuracy with which the given \texttt{ifo} can recover the parameter
$\psi_{0}$ of a signal.

\item[\texttt{--ifo-psi3-accuracy} \textsc{ifo\_dpsi3}] Optional. Set the
accuracy with which the given \texttt{ifo} can recover the parameter
$\psi_{3}$of a signal.

\item[\texttt{--num-slides} \textsc{num\_slides}] Optional.  Specify the
number of time slides to perform. Note that if time slides are performed, 
then the zero lag coincidences are \textit{not} found. Also, the output file 
is named \texttt{THINCA\_SLIDE}.

\item[\texttt{--ifo-slide} \textsc{ifo\_slide}] Optional.  Slide the data from 
this ifo by multiples of \textsc{ifo\_slide} seconds when doing time slides.  
The values chosen for the time slides must be different for all ifos.

\item[\texttt{--comment} \textsc{string}] Optional. Add \textsc{string}
to the comment field in the process table. If not specified, no comment
is added. 

\item[\texttt{--user-tag} \textsc{usertag}] Optional. Set the user tag for
this job to be \textsc{usertag}. May also be specified on the command line as
\texttt{-userTag} for LIGO database compatibility.  This will affect the
naming of the output file.

\item[\texttt{--ifo-tag} \textsc{ifotag}] Optional. Set the ifo tag for this
job to be \textsc{ifotag}. This will affect the naming of the output file.

\item[\texttt{--verbose}] Enable the output of informational messages.

\item[\texttt{--help}] Optional.  Print a help message and exit.

\item[\texttt{--version}] Optional.  Print out the author, CVS version and
tag information and exit.

\end{entry}

\item[Arguments]\leavevmode
\begin{entry}
\item[\texttt{[LIGO Lightweight XML files]}] The arguments to the program
should be a list of LIGO Lightweight XML files containing the triggers from
the two interferometers. The input files can be in any order and do not need
to be time ordered as \texttt{thinca} will sort all the triggers once they are
read in. If the program encounters a LIGO Lightweight XML containing triggers
from an unknown interferometer (i.e. not IFO A or IFO B) it will exit with an
error.
\end{entry}

\item[Example]
\begin{verbatim}
lalapps_thinca \
--data-type playground_only --h1-triggers --h2-triggers --l1-triggers \
--h1-time-accuracy 1 --h2-time-accuracy 1.5 --l1-time accuracy 1 \
--parameter-test mchirp_and_eta --h1-mchirp-accuracy 0.02 \
--h2-mchirp-accuracy 0.03 --l1-mchirp-accuracy 0.04 \ 
--h1-eta-accuracy 1 --h2-eta-accuracy 1 --l1-eta-accuracy 1 \
--gps-start-time 777001000 --gps-end-time 777002000 \
H1-INSPIRAL-777000500-2048.xml H2-INSPIRAL-777000700-2048.xml \
L1-INSPIRAL-777000500-2048.xml
\end{verbatim}

\item[Algorithm]
Not yet documented.


\item[Author] 
Steve Fairhurst
\end{entry}


