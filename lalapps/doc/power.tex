\section{Power Tools}
\label{section:powertools}

This section of \textsc{LALApps} contains programs that can be used to
perform burst searches using the excess power algorithm.   

Put a summary of the excess power algorithm here .........

\clearpage


\subsection{Program \texttt{lalapps\_power}}
\label{program:lalapps-power}
\idx[Program]{lalapps\_power}

\begin{entry}

\item[Name]
\verb$lalapps_power$ --- runs excess power code on chunks of (simulated) data.

\item[Synopsis]
\verb$lalapps_power$ \verb$--npts$ \textsc{npts} \verb$--nseg$ \textsc{nseg}
\verb$--olap$ \textsc{olap} \verb$--olapfctr$ \textsc{olapfctr}
$\backslash$ \newline \hspace*{0.25in}
\verb$--minfbin$ \textsc{minfbin} \verb$--mintbin$ \textsc{mintbin} 
\verb$--flow$ \textsc{flow} \verb$--delf$ \textsc{delf} 
\verb$--lngth$ \textsc{lngth} 
$\backslash$ \newline \hspace*{0.25in}
\verb$--nsigma$ \textsc{nsigma}
\verb$--alphdef$ \textsc{alphdef}  \verb$--segdcle$ \textsc{segdcle} 
\verb$--threshold$ \textsc{threshold} 
$\backslash$ \newline \hspace*{0.25in}
\verb$--etomstr$ \textsc{etomstr}
\verb$--channel$ \textsc{channel} \verb$--simtype$ \textsc{simtype} 
\verb$--spectype$ \textsc{spectype} 
$\backslash$ \newline \hspace*{0.25in}
\verb$--window$ \textsc{window} \verb$--start_time$ \textsc{sec} 
\verb$--start_time_ns$ \textsc{nsec} 
$\backslash$ \newline \hspace*{0.25in}
\verb$--numpts$ \textsc{numpts} [\verb$--printSpectrum$] 
\verb$--srate$ \textsc{srate} 
$\backslash$ \newline \hspace*{0.25in}
[\verb$--cluster$]
[\verb$--noise$ \textsc{var}] [\verb$--seed$ \textsc{seed}] 
$\backslash$ \newline \hspace*{0.25in}
[\verb$--comment$ \textsc{comment}]

\item[Description] 
\verb$lal_power$ runs the excess power code from LAL on a chunk of
real or simulated data.    Consider searching  for signals with the
following properties:
\begin{itemize}
\item Maximum signal time duration $T=2^a$ seconds where $a$ is a
positive or negative integer;  the sampling rate of the data stream is
taken assummed $\mbox{\texttt{srate}} = 2^b$ Hz.

\item The frequency band of the signal is between $f_{\mathrm{low}}$
Hz and ${f_{\mathrm{high}}}$ Hz.  Current versions of the code
expect ${f_{\mathrm{high}}}-{f_{\mathrm{low}}}=2^d$ Hz where
$d$ is an integer. 

\item Minimum time duration,

\item Minimum frequency bandwidth.
\end{itemize}

\item[Options]\leavevmode
\begin{entry}
\item[\texttt{--npts}  \textsc{npts}] Number of data points in a
segment is determined by
\[
\mbox{\textsc{npts}} = (T \times \mbox{\textsc{srate}}) \; .
\]  

\item[\texttt{--nseg} \textsc{nseg}] Number of overlapping segments into
which data should be divided for filtering;  must be an integer. 

\item[\texttt{--olap} \textsc{olap}] Number of points overlap between
segments.  This is an argument for completeness,  but in general it
should be $\textsc{npts}/2$.

\item[\texttt{--olapfctr} \textsc{olapfctr}] Amount of overlap between
neighboring TF tiles; must be an integer.  A reasonable value for this
parameter is $3$.  See LAL \texttt{burstsearch} package for details.  

\item[\texttt{--minfbin} \textsc{minfbin}] Smallest extent in frequency of
TF tiles to search;  must be an integer.  A reasonable value for this
parameter is $2$.   The product $\mbox{\textsc{minfbin}} \times
\mbox{\textsc{mintbin}}$ is the minimum time-frequency volume to
be searched.  See LAL \texttt{burstsearch} package for details.

\item[\texttt{--mintbin} \textsc{mintbin}] Smallest extent in time of TF
tiles to search;  must be an integer. A reasonable value for this
parameter is $2$.   The product $\mbox{\textsc{minfbin}} \times
\mbox{\textsc{mintbin}}$ is the minimum time-frequency volume to
be searched.  See LAL \texttt{burstsearch} package for details.

\item[\texttt{--flow} \textsc{flow}] Lowest frequency in Hz to be searched;
a real number.  This is obviously $f_{\mathrm{low}}$ Hz from our
description of the desired signal parameters above.

\item[\texttt{--delf} \textsc{delf}] This input should be set to $1/T$ Hz but
it is ignored by the current version of the code;
a real number.

\item[\texttt{--lngth} \textsc{lngth}] may be determined by the following
formula
\[
\mbox{\textsc{lngth}} = T \times ({f_{\mathrm{high}} - f_{\mathrm{low}}}) .
\]
This is an integer which determines the maximum frequency bandwidth
over which a signal is expected.  

\item[\texttt{--nsigma} \textsc{nsigma}] threshold number of sigma;
a real number.
Currently see LAL \texttt{burstsearch} package for details.

\item[\texttt{--alphdef} --\textsc{alphdef}] default alpha value for tiles
with sigma < numSigmaMin;
a real number. Currently see LAL \texttt{burstsearch}
package for details.

\item[\texttt{--segdcle} \textsc{segdcle}] Number of segments analyzed
at a time;  must be an integer.  The current code uses
\textsc{segdcle} overlapping segments to compute the average (or
median) power spectral estimate for use inside the code.

\item[\texttt{--threshold} \textsc{threshold}] Identify events with alpha
less than this;
a real number.  Currently see LAL \texttt{burstsearch} package for
details.

\item[\texttt{--etomstr} \textsc{etomstr}] Number of events to be
accepted from a search over \textsc{npts} of data;  must be an
integer.

\item[\texttt{--channel} \textsc{channel}] The name used to identify the
data to be analyzed;  a character string matching
the channel name in the frame files,  e.g. \texttt{H2:LSC-AS\_Q}.

\item[\texttt{--start\_time} \textsc{sec}] The GPS time
corresponding to the start of the time series read from frames.  Note:  
$\textsc{olap}$ points are discarded at the beginning and end of the
data to avoid data corrupted by the low-pass filtering.

\item[\texttt{--start\_time\_ns} \textsc{nsec}] The number of
nanoseconds after \textsc{sec} for the time series read from frames. 

\item[\texttt{--framecache} \textsc{frcache}] A LAL format frame
cache file.    The \textsc{frcache} can be a filename in the local
directory,  or a filename including absolute path.   These cache files
are explained in the \emph{framedata} package in LAL and can be
constructed by making calls to \emph{LALdataFind} on some systems.

\item[\texttt{--simtype} \textsc{simtype}] Type of simulation. Set it to 0,
although it is ignored in the current version of the code.

\item[\texttt{--spectype} \textsc{spectype}] Spectrum estimator for whitening
data;  a character string [\texttt{useMean}, \texttt{useMedian}].

\item[\texttt{--window} \textsc{window}] Type of window to use on the data;
must be an integer.  [Possible values are:  0=Rectangular, 1=Hann,
2=Welch, 3=Bartlett, 4=Parzen, 5=Papoulis, 6=Hamming.]

\item[\texttt{--numpts} \textsc{numpts}] The number of points of data
to be extracted from the frame files may be determined by the
following formula
\[
\mbox{\textsc{numpts}} = \mbox{\textsc{nseg}} \times (
\mbox{\textsc{npts}} - 
\mbox{\textsc{olap}} ) + 3 \times
\mbox{\textsc{olap}} \; .
\]
Notice that this appears to be $2 \times \textsc{olap}$ more points
than you might expect.   Since the data stream is high-pass filtered
internally,   the code ignores the first $\textsc{olap}$ points and
requires that there be an extra $\textsc{olap}$ points at the end to
avoid data corruption.

\item[\texttt{--cluster}] Apply a clustering algorithm to tiles
identified by the excess power code.  The result is reduction of
overlapping triggers to a single trigger which covers a square
time-frequency volume which encompasses all overlapping trigger
regions.   The signal-to-noise and the confidence associated with a
clustered trigger belong to the most significant excess-power trigger
in the cluster.  [This is a protoype option.  Its behavior is not
robustly tested.  Treat with care and look at the code to insure
understanding.]

\item[\texttt{--comment} \textsc{comment}] A user defined comment
string.  It should be less than 256 characters and should not contain
spaces (replace spaces by underscores).  This string will appear in
the name of the file to which output information is written.

\item[\texttt{--printSpectrum}] Print out the power spectrum to a
file.   Note:  this needs to be enhanced.  AT present it give some
help with debugging and understanding the data.

\item[\texttt{--printData}] Print out the time series that is read in
by the code.

\item[\texttt{--verbose}] Print out informational messages as the code
runs.

\item[\texttt{--dbglevel}] Set the lalDebugLevel.  The default is
\texttt{LALMSGLVL2}.   A useful setting is 65 which turns off memory
padding,  but keeps memory tracking and error messages.
\end{entry}


\item[Example]
To run the program,  type:
\begin{verbatim}
lalapps_power --npts 2048 --nseg 719 --olap 1024 --olapfctr 3 \
    --minfbin 2 --mintbin 2 --flow 100.0 --delf 1.0 --lngth 512 --nsigma 2.0 \
    --alphdef 0.5 --segdcle 32 --threshold 1.0e-13 --etomstr 10 \
    --channel S1:LSC-AS_Q --simtype 0 --spectype useMedian --window 2 \
    --epoch  693768279 0 --numpts 1048576 --printSpectrum --noise 1 11 \
    --comment simulation
\end{verbatim}

\item[Author]
Patrick Brady
\end{entry}
\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% manipulate the events from power code
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Program \texttt{lalapps\_snglBurstHistogram}}
\label{program:lalapps-snglBurstHistogram}
\idx[Program]{lalapps\_snglBurstHistogram}

\begin{entry}

\item[Name]
\verb$lalapps_snglBurstHistogram$ --- runs over LIGO lightweight files and histograms
the triggers by frequency.   

\item[Synopsis]
\verb$lalapps_snglBurstHistogram$ \verb$--input$ \textsc{infile} 
[\verb$--threshold$ \textsc{threshold}]    
$\backslash$ \newline \hspace*{0.25in}
\verb$--freq$ \textsc{fstart} \textsc{fstop} \textsc{df}
[\verb$--tfhist$ \textsc{outfile}] 
[\verb$--help$]

\item[Description] 
\verb$lal_snglBurstHistogram$ reads in LIGO lightweight files and
constructs a histogram of the triggers over frequency. This histogram data 
is then printed in the file \verb$freq-hist.txt$. It also produces a list of triggers for each playground segment separately and that is printed in the \textsc{outfile}, if provided.   The code
should be extensible to do a number of similar things like this.

\item[Options]\leavevmode
\begin{entry}
\item[\texttt{--input}  \textsc{infile}] The name of a file containing
a list of XML files to parse;  one XML file per line of
\textsc{infile}.

\item[\texttt{--table} \textsc{tablename}] The name of the table to be
parsed from the XML file.   This will be needed when the process
table is written into the XML files by the power code.

\item[\texttt{--threshold} \textsc{threshold}] Identify events with alpha
less than this; a real number.  The meaning of the threshold is the same as
\verb$lalapps_power$ itself.  (Optional)

\item[\texttt{--freq} \textsc{fstart} \textsc{fstop} \textsc{df}]
Parameters which define a frequency histogram.  \textsc{fstart} is the
lowest frequency;  \textsc{fstop} is the highest frequency; \textsc{df} 
is the width of abin.

\item[\texttt{--tfhist}  \textsc{outfile}] The name of a file which will 
contain the list of triggers per playground segment for each frequency bin.

\item[\texttt{--help}] Print usage instructions.
\end{entry}


\item[Example]
To run the program,  type:
\begin{verbatim}
lalapps_snglBurstHistogram --input files.txt --freq 100.0 1000.0 25.0 --tfhist tf.txt
\end{verbatim}
This will read in the xml files listed in files (see below) and
construct a frequency histogram with lowest frequency 100 Hz,  highest
frequency 1000 Hz and bin width 25 Hz. This output will be in \verb$freq-hist.txt.$
It will also produce the triggers for each playground segment and those will be in \verb$tf.txt$.  The file \verb$files.txt$
must contain a list of XML files.  Here are the first few lines from
such a file:
\begin{verbatim}
simtest-693768279-11.xml
simtest-693768311-21.xml
simtest-693768343-31.xml
simtest-693768375-41.xml
\end{verbatim}

\item[Author]
Patrick Brady

\end{entry}
\clearpage

\subsection{Program \texttt{lalapps\_burca}}
\label{program:lalapps-burca}
\idx[Program]{lalapps\_burca}

\begin{entry}
\item[Name]
\verb$lalapps_burca$ --- program does burst coincidence analysis.

\item[Synopsis]
\verb$lalapps_burca$ 
\verb$--ifo-a$ \textsc{trigfile.a} \verb$--ifo-b$ \textsc{trigfile.b} 
[\verb$--start-time$ \textsc{startcoincidence}]
$\backslash$ \newline \hspace*{0.25in}
[\verb$--stop-time$ \textsc{endcoincidence}] 
[\verb$--drhoplus$ \textsc{drhoplus}] [\verb$--drhominus$ \textsc{drhominus}] 
$\backslash$ \newline \hspace*{0.25in}
[\verb$--dt$ \textsc{deltat}] 
\verb$--outfile$ \textsc{outfile} [\verb$--noplayground$] 
[\verb$--help$]

\item[Description] 
\verb$lalapps_burca$ performs coincidence on triggers from the burst
search code.  (At present it works for only two interferometers.) It
must be called with at least one input file from each instrument. The
default behavior outputs triggers during playground times to the file
\textsc{outfile};  to obtain all triggers,  use the
\verb$--noplayground$ flag.     
%Events can also be clustered
%within \textsc{msec} msec or a template bank for triggered searches
%can be constructed.

\item[Options]\leavevmode
\begin{entry}
\item[\texttt{--ifo-a} \textsc{trigfile.a}] Required.  LIGO lightweight
XML file with triggers from interferometer A.  This argument can be
called multiple times.  Triggers are sorted \emph{after} all files
have been read in. 

\item[\texttt{--ifo-b} \textsc{trigfile.b}] Required.  LIGO lightweight
XML file with triggers from interferometer B.  This argument can be
called multiple times.  Triggers are sorted \emph{after} all files
have been read in. 

\item[\texttt{--start-time} \textsc{startcoincidence}] Optional.  Look for
coincident triggers with start times after \textsc{startcoincidence}.
If not supplied,  the $\textsc{startcoincidence} = 0$.

\item[\texttt{--stop-time} \textsc{endcoincidence}]  Optional. Look for
coincident triggers with start times before \textsc{endcoincidence}.
If not supplied,  then $\textsc{endcoincidence} = 977788813$, i.e.
00:00 Dec 31, 2010 UTC.

\item[\texttt{--drhoplus} \textsc{drhoplus}] Optional.  \textbf{Not yet
implemented.}

\item[\texttt{--drhominus} \textsc{drhominus}] Optional. \textbf{Not yet
implemented.}

\item[\texttt{--dt} \textsc{deltat}] Optional. Accept triggers as coincident if
their start times agree within \textsc{deltat} in msec.  If not supplied,  then 
$\textsc{deltat} = 0$.

\item[\texttt{--outfile} \textsc{outfile}] Required.  Name of the file
to be used for output.  The output format is LIGO lightweight XML with
only a \texttt{sngl\_burst} table.

\item[\texttt{--noplayground}] Optional.  Record all triggers.  The
default behaviour returns only those triggers which lie in the
playground data set.  

\item[\texttt{--cluster} \textsc{msec}] Optional.  \textbf{Not yet
implemented.}  Cluster triggers within \textsc{msec} msec window.

\item[\texttt{--help}] Optional.  Print a help message.
\end{entry}

\item[Example]
\begin{verbatim}
lalapps_burca --ifo-a L-POWER-734357353-1024.xml \
--ifo-b H-POWER-734357353-1024.xml --dt 10 --outfile my.xml \
--start-time 734357353  --stop-time 734358353 --noplayground
\end{verbatim}
\item[Author] 
Patrick Brady
\end{entry}
\clearpage

